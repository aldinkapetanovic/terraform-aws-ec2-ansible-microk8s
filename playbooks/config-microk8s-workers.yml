---
- hosts: workers
  tasks:
    - name: Add ubuntu user to docker group
      become: true
      user:
        name: ubuntu
        groups: microk8s
        append: true
    - name: Reset ssh connection to allow user changes to affect ubuntu user
      ansible.builtin.meta: reset_connection
    - name: Setup .kube for ubuntu user
      file:
        path: /home/ubuntu/.kube
        state: directory
        owner: ubuntu
        group: ubuntu
    - name: CoreDNS
      command: microk8s enable dns
